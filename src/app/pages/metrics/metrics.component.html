<div class="metrics-container">
  <div class="metrics-header">
    <h1 class="metrics-title">åœ–åƒå“è³ªæŒ‡æ¨™è¦–è¦ºåŒ–å„€è¡¨æ¿</h1>
    <p class="metrics-subtitle">Image Quality Metrics Visualization Dashboard</p>
  </div>

  <!-- Data Upload Section -->
  <div class="data-upload-section">
    <p-fileUpload
        mode="basic"
        chooseLabel="ä¸Šå‚³ JSON æ•¸æ“š / Upload JSON Data"
        chooseIcon="pi pi-upload"
        accept=".json"
        maxFileSize="5000000"
        [customUpload]="true"
        (uploadHandler)="onUpload($event)"
        [auto]="true"
        styleClass="p-button-help p-button-lg w-full md:w-auto">
    </p-fileUpload>
  </div>

  <!-- View Mode Toggle -->
  <div class="view-toggle" *ngIf="!loading && metrics.length > 0">
    <p-selectButton
      [options]="viewOptions"
      [(ngModel)]="viewMode"
      optionLabel="label"
      optionValue="value">
    </p-selectButton>
    <p-button
      *ngIf="showCharts()"
      label="Export All Charts"
      icon="pi pi-download"
      (onClick)="exportAllCharts()"
      styleClass="p-button-outlined export-all-btn">
    </p-button>
  </div>

  <!-- Charts Section -->
  <div class="metrics-charts" *ngIf="showCharts() && !loading && metrics.length > 0">
    <!-- Radar Chart for Overall Comparison -->
    <div class="radar-chart-container">
      <p-card header="Overall Capability Comparison (Radar)" styleClass="metrics-card radar-card">
        <p class="radar-description">
          ğŸŸ¢ è¶Šæ¥è¿‘å¤–åœˆè¶Šå¥½ | â†‘ Higher is Better, â†“ Lower is Better (å·²è½‰æ›ç‚ºèƒ½åŠ›åˆ†æ•¸)
        </p>
        <div class="chart-container radar-chart">
          <p-chart type="radar" [data]="radarChartData" [options]="radarChartOptions"></p-chart>
        </div>
      </p-card>
    </div>

    <!-- Bar Charts Grid -->
    <h3 class="charts-section-title">ğŸ“Š Individual Metrics Comparison</h3>
    <div class="charts-grid">
      <!-- Higher is Better Metrics -->
      <p-card header="PSNR (Higher is Better) â†‘" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="psnrChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="SSIM (Higher is Better) â†‘" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="ssimChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <!-- Lower is Better Metrics -->
      <p-card header="NIQE (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="niqeChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="BRISQUE (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="brisqueChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="LOE (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="loeChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="LPIPS (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="lpipsChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <!-- Delta E Metrics -->
      <p-card header="Delta E76 vs Original (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="deltaE76OriginalChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="Delta E76 vs Reference (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="deltaE76ReferenceChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <!-- CIEDE2000 Metrics -->
      <p-card header="CIEDE2000 vs Original (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="ciede2000OriginalChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="CIEDE2000 vs Reference (Lower is Better) â†“" styleClass="metrics-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="ciede2000ReferenceChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <!-- Angular Error Metrics (Critical for HSV method) -->
      <p-card header="Angular Error vs Original (Lower is Better) â†“ ğŸ”‘" styleClass="metrics-card highlight-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="angularErrorOriginalChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>

      <p-card header="Angular Error vs Reference (Lower is Better) â†“ ğŸ”‘" styleClass="metrics-card highlight-card">
        <div class="chart-container">
          <p-chart type="bar" [data]="angularErrorReferenceChartData" [options]="chartOptions"></p-chart>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Tables Section -->
  <div class="metrics-content" *ngIf="showTable() && !loading && metrics.length > 0">
    <p-card header="Model Comparison Overview" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Dataset</th>
            <th>Image Name</th>
            <th>NIQE</th>
            <th>BRISQUE</th>
            <th>LOE</th>
            <th>PSNR</th>
            <th>SSIM</th>
            <th>LPIPS</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.dataset }}</td>
            <td>{{ metric.image_name }}</td>
            <td>{{ metric.metrics.niqe | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.brisque | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.loe | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.psnr | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.ssim | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.lpips | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <p-card header="Delta E76 vs Original" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Mean</th>
            <th>Std</th>
            <th>Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.metrics.delta_e76_vs_original.mean | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.delta_e76_vs_original.std | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.delta_e76_vs_original.max | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <p-card header="CIEDE2000 vs Original" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Mean</th>
            <th>Std</th>
            <th>Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.metrics.ciede2000_vs_original.mean | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.ciede2000_vs_original.std | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.ciede2000_vs_original.max | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <p-card header="Angular Error vs Original" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Mean</th>
            <th>Std</th>
            <th>Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.metrics.angular_error_vs_original.mean | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.angular_error_vs_original.std | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.angular_error_vs_original.max | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <p-card header="Delta E76 vs Reference" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Mean</th>
            <th>Std</th>
            <th>Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.metrics.delta_e76_vs_reference.mean | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.delta_e76_vs_reference.std | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.delta_e76_vs_reference.max | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <p-card header="CIEDE2000 vs Reference" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Mean</th>
            <th>Std</th>
            <th>Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.metrics.ciede2000_vs_reference.mean | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.ciede2000_vs_reference.std | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.ciede2000_vs_reference.max | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <p-card header="Angular Error vs Reference" styleClass="metrics-card">
      <p-table [value]="metrics" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
          <tr>
            <th>Model</th>
            <th>Mean</th>
            <th>Std</th>
            <th>Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-metric>
          <tr>
            <td>{{ metric.model }}</td>
            <td>{{ metric.metrics.angular_error_vs_reference.mean | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.angular_error_vs_reference.std | number:'1.4-4' }}</td>
            <td>{{ metric.metrics.angular_error_vs_reference.max | number:'1.4-4' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>

  <div class="metrics-loading" *ngIf="loading">
    <p>Loading metrics data...</p>
  </div>

  <div class="metrics-empty" *ngIf="!loading && metrics.length === 0">
    <p>No metrics data available.</p>
  </div>
</div>
